var MMTimer,__assign,__spreadArray,VideoEvents;(function(n){var t=function(){function n(n,t,i,r,u){var f,e;i===void 0&&(i=!0);r===void 0&&(r=!1);u===void 0&&(u=0);f=this;this.start=function(){this.running||(this.running=!0,this.startedDate=(new Date).getTime(),this.timer=this.useInterval?setInterval(this.callback,this.timeoutMS):setTimeout(this.callback,this.remaining))};this.pause=function(){this.timer&&this.running&&(this.useInterval||(this.running=!1,clearTimeout(this.timer),this.remaining-=(new Date).getTime()-this.startedDate))};this.getTimeLeft=function(){return this.running&&(this.pause(),this.start()),this.remaining};this.getStateRunning=function(){return this.running};this.destroy=function(){this.running=!1;this.useInterval?clearInterval(this.timer):clearTimeout(this.timer);this.remaining=-1};this.callback=n;this.remaining=t;this.timeoutMS=t;this.useInterval=r;r&&u>0&&(this.remaining=u,e=function(){f.remaining>0&&(f.remaining-=t,f.remaining>0&&n())},this.callback=e.bind(this));i===!0&&this.start()}return n}();n.Timer=t})(MMTimer||(MMTimer={}));__assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__assign.apply(this,arguments)};__spreadArray=this&&this.__spreadArray||function(n,t,i){if(i||arguments.length===2)for(var r=0,f=t.length,u;r<f;r++)!u&&r in t||(u||(u=Array.prototype.slice.call(t,0,r)),u[r]=t[r]);return n.concat(u||Array.prototype.slice.call(t))},function(){function gi(i){(t("started initialization",i),i&&!(i.length<2)&&i[1]&&nt&&n)&&(vt=i[1].videoType,w=i[1].videoExtraInfo,r=i[1].bindEventSupportedList?i[1].bindEventSupportedList:r,ei=i[1].skipPerVideoCI,i[1].videoEventsConfig&&si(i[1].videoEventsConfig),!dt&&n&&(gt(),ir()),i[1].videoDuration&&st(i),w&&cr(),t("finished initialization"),ot(i))}function nr(t){t&&!(t.length<2)&&t[1]&&nt&&n&&si(t[1])}function si(n){var f,i,u;g.ciClearTimer&&typeof e==p&&typeof n==p&&JSON.stringify(e)==JSON.stringify(n)||(e=n,rt=!1,fi=(f=e.ci)===null||f===void 0?void 0:f.noci,i=e.ecietl,(i===null||i===void 0?void 0:i.length)&&(r=i),tr(),u=e.tcic,(u===null||u===void 0?void 0:u.length)&&u.forEach(function(n){var i,t=n.inm;a[t]=n;n.ft>0&&(ut[t]=n.ft);ft(n.ste,t,yt);ft(n.pte,t,pt);ft(n.cte,t,wt);ft(n.utte,t,oi);bt[t]=n.efs;kt[t]=n.dfs;!rt&&((i=n.drld)===null||i===void 0?void 0:i.indexOf(k.videoPlayTime))>=0&&(rt=!0)}),t("Config: extra-CI",a))}function tr(){var n,r,i;if(g.ciClearTimer)n=Object.keys(c),(n===null||n===void 0?void 0:n.length)&&n.forEach(function(n){var i=c[n];typeof(i===null||i===void 0?void 0:i.destroy)==h&&(i.destroy(),t("clear timer (triggered by clearing video event config): "+n))});else for(r in Object.keys(c))i=c[r],typeof(i===null||i===void 0?void 0:i.destroy)==h&&(i.destroy(),t("clear timer (triggered by clearing video event config): "+r));c={};a={};v={};ut={};yt={};pt={};wt={};oi={};bt={};kt={}}function ft(n,t,i){(n===null||n===void 0?void 0:n.length)&&i&&n.forEach(function(n){i[n]||(i[n]=new Set);i[n].add(t)})}function hi(n){var i=bt[n],r=kt[n],u=!1,t;if(i===null||i===void 0?void 0:i.length){for(t=0;t<i.length;t++)if(ci(i[t])){u=!0;break}}else u=!0;if(r===null||r===void 0?void 0:r.length)for(t=0;t<r.length;t++)if(ci(r[t])){u=!1;break}return u}function ci(n){if(n&&typeof _d==p&&typeof _d.querySelector==h)try{return _d.querySelector(n)}catch(i){return t("invalid selector",n),!1}}function li(n){return(n===null||n===void 0?void 0:n.size)?Array.from(n).filter(function(n){return hi(n)}):null}function ir(){(r===null||r===void 0?void 0:r.indexOf("video"))!=-1&&(sj_evt.bind(n.EmbedPlayer_ComponentUpdate,ai),sj_evt.bind(n.EmbedPlayer_Load,ot),sj_evt.bind(n.VideoCanvas_VideoPlaying,et),sj_evt.bind(n.VideoCanvas_VideoStopped,s),sj_evt.bind(n.VideoCanvas_VideoEnded,s),sj_evt.bind(n.VideoCanvas_VideoPlayerReady,st));u&&(r===null||r===void 0?void 0:r.indexOf("preview"))!=-1&&(sj_evt.bind(u.PlayerDownloadEndEvt,vi),sj_evt.bind(u.PlayerStartEvt,et),sj_evt.bind(u.PlayerEndEvt,s),sj_evt.bind(u.PlayerErrEvt,s),sj_evt.bind(u.PlayerPauseEvt,s),sj_evt.bind(u.StopPlayEvt,s));dt=!0;sj_be(_w,ii,gt)}function rr(){if(typeof(o===null||o===void 0?void 0:o.destroy)==h){if(it){var n=o.getTimeLeft();o.pause();n>0&&!b&&n<di&&ni(!0)}o.destroy();t("clear video IsCI timer")}fi&&!b&&f&&ni(!1);o=null;b=!1;it=!1}function ai(n){rr();fr(n);ur()}function ur(){y=null;d=0}function fr(n){var u=ht(n),r=wt[u],i;(r===null||r===void 0?void 0:r.size)&&(i=Array.from(r),(i===null||i===void 0?void 0:i.length)&&i.forEach(function(n){var i=c[n],e=v[n],r,f;typeof(i===null||i===void 0?void 0:i.destroy)==h&&(r=a[n],r.atdoe>0&&(f=i.getTimeLeft(),i.pause(),f>0&&!e&&f<r.atdoe&&i.fireCallback==h&&(i.fireCallback(),v[n]=!0)),i.destroy(),t("clear timer: "+n+" by event: "+u));c[n]=null;v[n]=!1}))}function er(){if(!b){if(o)o.start();else{var n=yi();o=new nt(hr,n)}t("startTimer")}}function et(n){er();ot(n)}function ot(n){var r=ht(n),i=li(yt[r]);(i===null||i===void 0?void 0:i.length)&&i.forEach(function(i){var u=a[i];if(u)u.uvdbs&&st(n);else return;u.ft>0||(ut[i]=yi());or(i,u);t("startTimer: "+i+" by event: "+r)})}function or(n,t){var r=t.uit,e=t.ciat,o=v[n],i,u,f;(!o||r)&&(i=c[n],i?i.start():(u=yr(n),f=vr(n),c[n]=new nt(f,u,!0,r,e)))}function s(n){o===null||o===void 0?void 0:o.pause();t("pauseTimer");sr(n)}function sr(n){var r=ht(n),i=li(pt[r]);(i===null||i===void 0?void 0:i.length)&&i.forEach(function(n){var i=c[n];i&&(i.pause(),t("pauseTimer",n,r))})}function gt(){(r===null||r===void 0?void 0:r.indexOf("video"))!=-1&&(sj_evt.unbind(n.EmbedPlayer_ComponentUpdate,ai),sj_evt.unbind(n.VideoCanvas_VideoPlaying,et),sj_evt.unbind(n.EmbedPlayer_Load,ot),sj_evt.unbind(n.VideoCanvas_VideoStopped,s),sj_evt.unbind(n.VideoCanvas_VideoEnded,s),sj_evt.unbind(n.VideoCanvas_VideoPlayerReady,st));u&&(r===null||r===void 0?void 0:r.indexOf("preview"))!=-1&&(sj_evt.unbind(u.PlayerDownloadEndEvt,vi),sj_evt.unbind(u.PlayerStartEvt,et),sj_evt.unbind(u.PlayerEndEvt,s),sj_evt.unbind(u.PlayerErrEvt,s),sj_evt.unbind(u.PlayerPauseEvt,s),sj_evt.unbind(u.StopPlayEvt,s));dt=!1;sj_ue(_w,ii,gt)}function st(n){if(i=-1,n&&!(n.length<2)&&n[1]){var r=n[1];r.videoDuration>0&&(i=r.videoDuration*ui);switch(vt){case"video":it=i<=lt;break;case"preview":it=i<=at}i>ri?y="long":i>0&&(y="short");t("update duration",i,y)}}function vi(n){if(i=-1,n&&!(n.length<5)&&n[4]){var t=n[4];t>0&&(i=t*ui)}}function t(n){for(var i=[],t=1;t<arguments.length;t++)i[t-1]=arguments[t];"object"===p&&"object"===h}function ht(n){return(n===null||n===void 0?void 0:n.length)?n[0]:""}function hr(){if(ei){t("Skip per video IsCI");return}ni(!0);t("IsCI")}function cr(){var n={TS:null,T:null,AppNS:bi},t={recoFeedbackType:null,videoExtraInfo:__assign({},w)};w&&(n=__assign(__assign({},n),w));f={j:n,r:t}}function ni(t){var r,u,o,i=f===null||f===void 0?void 0:f.j,s=f===null||f===void 0?void 0:f.r;i&&s&&(i.T=t?"IsCI":"IsNoCI",i.TS=(new Date).getTime(),((r=e===null||e===void 0?void 0:e.ci)===null||r===void 0?void 0:r.eld)&&(i=__assign(__assign({},i),e.ci.eld)),((o=(u=e===null||e===void 0?void 0:e.ci)===null||u===void 0?void 0:u.drld)===null||o===void 0?void 0:o.length)&&e.ci.drld.indexOf(k.videoSubType)>=0&&(i.videoSubType=y),s.recoFeedbackType=t?"IsCI":"IsNoCI",pInstr.icd(i),typeof(sj_evt===null||sj_evt===void 0?void 0:sj_evt.fire)==h&&(sj_evt.fire(n.VideoEvent_SendRecoFeedback,s),sj_evt.fire(n.VideoCanvas_VideoCI,i)),b=t,(l===null||l===void 0?void 0:l.ithe())&&(i.TS=null,sj_evt.fire(SharedEventString===null||SharedEventString===void 0?void 0:SharedEventString.VideoEvent_LogInst,JSON.stringify(i),i.T)))}function lr(i){var o,u=a[i],r,e,c,s;u&&hi(i)&&(r=f===null||f===void 0?void 0:f.j,r)&&(r.T=u.t,r.TS=(new Date).getTime(),e=u.ldwl,(e===null||e===void 0?void 0:e.length)&&(r=ar(r,e)),u.eld&&(r=__assign(__assign({},r),u.eld)),((o=u.drld)===null||o===void 0?void 0:o.length)&&(u.drld.indexOf(k.videoSubType)>=0&&(r.videoSubType=y),u.drld.indexOf(k.videoPlayTime)>=0&&d&&!isNaN(d)&&(r[k.videoPlayTime]=Math.round(d))),pInstr.icd(r),c=u.uit,c||(v[i]=!0),t("Sent "+(u===null||u===void 0?void 0:u.t)),u.erf&&(s=f===null||f===void 0?void 0:f.r,s&&typeof(sj_evt===null||sj_evt===void 0?void 0:sj_evt.fire)==h&&(sj_evt.fire(n.VideoEvent_SendRecoFeedback,s),t("Sent reco feedback"))),(l===null||l===void 0?void 0:l.ithe())&&(r.TS=null,sj_evt.fire(SharedEventString===null||SharedEventString===void 0?void 0:SharedEventString.VideoEvent_LogInst,JSON.stringify(r),r.T)))}function ar(n,t){var i={},r=__spreadArray(__spreadArray([],ki,!0),t,!0);return r.forEach(function(t){n[t]!==undefined&&n[t]!==null&&(i[t]=n[t])}),i}function vr(n){return function(){lr(n)}}function yi(){switch(vt){case"video":return i>ri?tt:i>0?Math.min(i,lt):lt;case"preview":return i>0?Math.min(i,at):at;default:return g.defaultValueUpdate?i>0?Math.min(i,tt):tt:Number.MAX_SAFE_INTEGER}}function yr(n){var t=ut[n];return typeof t==pi?t:g.defaultValueUpdate?tt:Number.MAX_SAFE_INTEGER}function pr(n){var i,t;!rt||(n===null||n===void 0?void 0:n.length)<2||(t=(i=n[1])===null||i===void 0?void 0:i.currentTime,typeof t=="number"&&t>0&&(d=t))}var ct,p="object",pi="number",h="function",wi="Video.CI",ti=typeof Multimedia==p&&typeof((ct=Multimedia.Video)===null||ct===void 0?void 0:ct.swte)==h?Multimedia.Video.swte:function(){return!1},g={defaultValueUpdate:ti("cidfvu"),ciClearTimer:ti("cictm")},l=typeof(Multimedia===null||Multimedia===void 0?void 0:Multimedia.MultimediaTestUtils)!="undefined"?Multimedia.MultimediaTestUtils:null,u=typeof VRHConsts!="undefined"?VRHConsts:null,n=typeof SharedEventString!="undefined"?SharedEventString:null,nt=typeof MMTimer!="undefined"?MMTimer.Timer_FixPause||MMTimer.Timer:null,ii="unload",bi="video",ki=["T","TS","AppNS"],ri=3e4,tt=2e4,lt=8e3,at=8e3,ui=1e3,di=1e3,i,w,vt,o,b=!1,it=!1,f,fi=!1,r=["preview","video"],ei=!1,rt=!1,e=null,a={},c={},v={},ut={},yt={},pt={},wt={},oi={},bt={},kt={},k={videoSubType:"videoSubType",videoPlayTime:"videoPlayTime"},y,dt=!1,d;sj_evt.bind(n===null||n===void 0?void 0:n.VideoCanvas_InitIsCIModule,gi,!0);sj_evt.bind(n===null||n===void 0?void 0:n.VideoCanvas_UpdateVideoEventsConfig,nr,!0);sj_evt.bind(SharedEventString===null||SharedEventString===void 0?void 0:SharedEventString.VideoPlayer_InfoUpdate,pr,!0);t("Configurable CI loaded")}(VideoEvents||(VideoEvents={}))